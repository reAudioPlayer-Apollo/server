<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>Apollo - Web / Share Files</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet" />
    <link href="/index-src/master.css" type="text/css" rel="stylesheet" />
    <link href="/dist/dropzone.css" type="text/css" rel="stylesheet" />

    <link href="/audioplayer/audioplayer.css" type="text/css" rel="stylesheet" />

    <script>window.hideBody = false</script>
    <script src="/dist/dropzone.js"></script>
    <script src="/index-src/login.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script src="/share/socket.js"></script>
    <script src="/share/share.js"></script>
    <script src="/share/receive.js"></script>
    <script src="/src/spotify.js"></script>
    <script src="/audioplayer/audioplayer.js"></script>
</head>

<body>
    <div class="wrapper">
        <div id="overlay" class="overlay hidden">
            <div class="overlay-header">
                <a class="root-link" href="/"> <h1>reAudioPlayer Apollo - Web</h1> </a>
                <span onclick="closeOverlay()" class="material-icons-outlined">close</span>
            </div>
            <div class="link-wrapper">
                <div class="function">
                    <a href="/spotify">Release Radar</a><br>
                </div>
                <div class="function">
                    <a href="/share">File Sharing</a><br>
                </div>
                <div class="function">
                    <a href="/visualiser/v2">Streamer</a><br>
                </div>
                <div class="function">
                    <a href="/youtube-dl">Youtube Downloader</a><br>
                </div>
                <a class="hidden" href="https://icons8.com/icon/7820/male-user">Male User icon by Icons8</a>
            </div>
        </div>

        <div class="main">
            <div class="header">
                <div class="title">
                    <a class="root-link" onclick="openOverlay()" > <h1>reAudioPlayer Apollo - Web / Share</h1> </a>
                </div>
                <div class="user">
                    <div id="user-loggedIn" class="loggedIn">
                        <div class="userinfo">
                            <img alt="avatar" id="user-icon"
                                src="https://img.icons8.com/ios/60/000000/user-male-circle.png">
                            <a href="/settings" id="user-email">Your Email</a>
                        </div>
                        <div class="logout">
                            <a href="/logout">Log Out</a>
                        </div>
                    </div>
                    <div id="user-loggedOut" class="loggedOut">
                        <a href="/login">Log In</a>
                    </div>
                </div>
            </div>
            <div class="body" id="body">
                <div class="function">
                    <h3>Share</h3>
                    <label for="code">Share Code:</label>
                    <span contenteditable="false" onclick="toClipboard(innerText)" id="code" class="text-input toclipboard"></span>
                    <form action="/file-upload" class="dropzone input" id="sendZone"></form>
                </div>
                <div class="function">
                    <h3>Receive</h3>
                    <label for="code">Receive Code:</label>
                    <span contenteditable="true" id="receiveCode" class="text-input"></span>
                    <form action="/file-upload" class="dropzone input hidden" id="receiveZone"></form>
                    <button onclick="subscribe()" class="negative">Subscribe</button>
                    <div class="input flex" id="receiver"></div>
                    <reaudioplayer></reaudioplayer>
                    <br>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    function openOverlay()
    {
        document.getElementById("overlay").classList.remove("hidden")
    }
    
    function closeOverlay()
    {
        document.getElementById("overlay").classList.add("hidden")
    }
</script>

<script>
    document.getElementById("code").innerText = makeid(6)
    dropzoneInit();

    const urlParams = new URLSearchParams(window.location.search);
    const rcode = urlParams.get('rcode');
    document.getElementById("receiveCode").innerText = rcode;
    subscribe();
</script>

<script>
    function commandListener(command, data = null)
    {
        window.socket.emit("web.fileMsg", {command, code: document.getElementById("code").innerText, data})
    }
</script>