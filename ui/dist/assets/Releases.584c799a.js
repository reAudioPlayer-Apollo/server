import{F as V}from"./FullShelf.7e3e3ced.js";import{_ as w,o as r,c as d,a as s,t as _,g as b,r as h,i as g,n as C,p as T,b as M,j as B,w as S,k as v,v as F,F as A,e as k,l as D,d as f,f as j}from"./index.978bc30f.js";import{F as R}from"./FindSources.cc4cae70.js";import{C as $}from"./CollectionHeader.38dc36af.js";const H={name:"MiniPlayer",props:{src:String,display:{type:Boolean,default:!0}},data(){return{playing:!1}},methods:{get(t){fetch(`/api/${t}`)},pause(){this.get("pause")},play(){this.get("play")},playPause(){this.$refs.player.onended||(this.$refs.player.onended=()=>{this.playing=!1}),window.player=this.$refs.player,this.playing=this.$refs.player.paused,this.$refs.player.paused?(this.pause(),this.$refs.player.play()):this.$refs.player.pause()}}},U={class:"miniPlayer"},x=["src"];function J(t,e,l,u,o,i){return r(),d("div",U,[s("audio",{src:l.src,ref:"player"},null,8,x),l.display?(r(),d("span",{key:0,onClick:e[0]||(e[0]=(...p)=>i.playPause&&i.playPause(...p)),class:"material-symbols-rounded circle"},_(o.playing?"pause":"play_arrow"),1)):b("",!0)])}var E=w(H,[["render",J],["__scopeId","data-v-3c0addea"]]);const q={components:{MiniPlayer:E},name:"AlbumEntry",props:{index:Number,id:Number,source:String,artist:{type:String,default:"N/A"},title:{type:String,default:"N/A"},added:Boolean,preview:String},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks",hovering:!1}},methods:{remove(){fetch("/api/remove",{method:"POST",body:JSON.stringify({playlistId:Number(this.$route.params.id),songId:this.id})})},onselect(){this.highlighted=!this.highlighted},playAt(){this.$emit("edit",this.index)},add(){console.log("add"),this.$emit("add",this.index)}},watch:{added(){console.log("change"),this.$refs.add.innerHTML=this.added?"done":"add"}}},z={class:"track"},L={class:"trackwrapper"};function Y(t,e,l,u,o,i){const p=h("mini-player");return r(),d("div",{onDblclick:e[2]||(e[2]=()=>{i.playAt(),i.onselect()}),onClick:e[3]||(e[3]=(...c)=>i.onselect&&i.onselect(...c)),onMouseover:e[4]||(e[4]=c=>o.hovering=!0),onMouseleave:e[5]||(e[5]=c=>o.hovering=!1),class:C(["albumEntry",{selected:o.highlighted}])},[g(p,{class:C(["miniPlayer",{hidden:!o.hovering}]),src:l.preview},null,8,["class","src"]),o.hovering?b("",!0):(r(),d("span",{key:0,onClick:e[0]||(e[0]=(...c)=>t.edit&&t.edit(...c)),class:"id"},_(l.index+1),1)),s("div",z,[s("div",L,[s("span",{class:C(["title",{playing:t.playing}])},_(l.title),3),s("span",{class:C(["artist",{playing:t.playing}])},_(l.artist),3)])]),s("span",{onClick:e[1]||(e[1]=(...c)=>i.add&&i.add(...c)),class:"material-symbols-rounded edit",ref:"add"},"add",512)],34)}var G=w(q,[["render",Y],["__scopeId","data-v-316c51ee"]]);const K={name:"AlbumHeader"},O=t=>(T("data-v-1a51c33d"),t=t(),M(),t),Q={class:"gridHeader"},W=O(()=>s("span",{class:"id"},"#",-1)),X=O(()=>s("span",{class:"title"},"Title",-1)),Z=[W,X];function ee(t,e,l,u,o,i){return r(),d("div",Q,Z)}var te=w(K,[["render",ee],["__scopeId","data-v-1a51c33d"]]);const se={name:"AddAlbumToPlaylist",components:{FindSources:R,AlbumEntry:G,AlbumHeader:te},props:{cover:String,artist:String,title:String,href:String,id:String,userData:Object},data(){return{showModal:!1,selectedPlaylist:-1,playlist:[],editSong:!1}},computed:{playlists(){var t,e;return(((e=(t=this.userData)==null?void 0:t.data)==null?void 0:e.playlists)||[]).map(l=>l==null?void 0:l.name)}},methods:{share(){window.open(this.href)},close(){this.showModal=!1,this.$emit("close")},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")},addAll(){for(let t=0;t<this.playlist.length;t++)this.add(t)},add(t){const e=this.playlist[t],l=this.playlists.findIndex(u=>u==this.selectedPlaylist);if(console.log(e,l),l<0){alert("no playlist selected");return}this.userData.data.playlists[l].songs.push({source:e.src,title:e.title,artist:e.artists.join(", "),album:this.title,cover:this.cover,duration:"-1:59"}),e.added=!0}},watch:{showModal(){!this.showModal||fetch("/spotify/album",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:window.location.hash.split("=")[1],albumId:this.id})}).then(t=>t.json()).then(t=>{this.playlist.length=0,this.playlist.push(...t)})}}},m=t=>(T("data-v-0d14bb02"),t=t(),M(),t),le={class:"wrapper"},ae={class:"header"},ie=m(()=>s("h3",null,"Add album",-1)),oe=m(()=>s("span",{class:"material-symbols-rounded"}," close ",-1)),re=[oe],ne=m(()=>s("h4",null,"To Playlist",-1)),de=m(()=>s("br",null,null,-1)),ue={key:0},ce=m(()=>s("h4",null,"Source",-1)),_e={class:"content"},he=m(()=>s("h4",null,"Title",-1)),pe={class:"content"},me=m(()=>s("h4",null,"Album",-1)),ye={class:"content"},ve=m(()=>s("h4",null,"Artist",-1)),fe={class:"content"},ge=m(()=>s("h4",null,"Cover",-1)),be={class:"content"},we=["src"],Se={class:"confirm"},De={key:1},Ae=["src"],ke={class:"details"},Ce={class:"detailswrapper"},Ie=j("Album"),Pe=m(()=>s("hr",null,null,-1)),Ne=m(()=>s("hr",null,null,-1)),Te={class:"confirm"};function Me(t,e,l,u,o,i){const p=h("FindSources"),c=h("h7"),y=h("album-header"),I=h("album-entry"),P=h("vue-final-modal"),n=B("observe-visibility");return r(),d("div",null,[g(P,{onClick:t.hideFindSourcesCtx,modelValue:o.showModal,"onUpdate:modelValue":e[13]||(e[13]=a=>o.showModal=a),classes:"modal-containerr","content-class":"addAlbumToPlaylistPopup"},{default:S(()=>[s("div",le,[s("div",ae,[ie,s("button",{class:"modal-close",onClick:e[0]||(e[0]=(...a)=>i.close&&i.close(...a))},re)]),ne,v(s("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.selectedPlaylist=a)},[(r(!0),d(A,null,k(i.playlists,a=>(r(),d("option",{key:a},_(a),1))),128))],512),[[F,o.selectedPlaylist]]),de,o.editSong?(r(),d("div",ue,[ce,g(p,{ref:"findSources",title:l.title,artist:l.artist},{default:S(()=>[s("div",_e,[v(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>t.dSource=a),ref:"source"},null,512),[[D,t.dSource]]),s("span",{class:"material-symbols-rounded more",ref:"sourceMore",onClick:e[3]||(e[3]=(...a)=>t.opencontextmenu&&t.opencontextmenu(...a))},"more_vert",512)])]),_:1},8,["title","artist"]),he,s("div",pe,[v(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>t.dTitle=a),type:"text"},null,512),[[D,t.dTitle]])]),me,s("div",ye,[v(s("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>t.dAlbum=a),type:"text",ref:"album"},null,512),[[D,t.dAlbum]])]),ve,s("div",fe,[v(s("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>t.dArtist=a),type:"text"},null,512),[[D,t.dArtist]])]),ge,s("div",be,[v(s("input",{type:"text",class:"addSong cover","onUpdate:modelValue":e[7]||(e[7]=a=>t.dCover=a),ref:"cover"},null,512),[[D,t.dCover]]),s("img",{onClick:e[8]||(e[8]=(...a)=>i.openInNewTab&&i.openInNewTab(...a)),class:"addSong cover",src:t.dCover?t.dCover:"/assets/img/music_placeholder.png"},null,8,we)]),s("div",Se,[s("button",{onClick:e[9]||(e[9]=(...a)=>i.add&&i.add(...a)),class:"negative"},"Add")])])):(r(),d("div",De,[v((r(),d("div",{class:"padding-20 playlisteditor",onClick:e[11]||(e[11]=(...a)=>t.editPlaylist&&t.editPlaylist(...a))},[s("img",{class:"cover",src:l.cover},null,8,Ae),s("div",ke,[s("div",Ce,[g(c,null,{default:S(()=>[Ie]),_:1}),s("span",{class:"material-symbols-rounded share",onClick:e[10]||(e[10]=(...a)=>i.share&&i.share(...a))},"share")]),s("h1",null,_(l.title),1),s("h5",null,_(l.artist),1)])])),[[n,t.headerVisibilityChanged]]),Pe,g(y),Ne,(r(!0),d(A,null,k(o.playlist,(a,N)=>(r(),f(I,{onAdd:i.add,key:N,added:a.added,index:N,cover:a.cover,artist:a.artists.join(", "),title:a.title,source:a.source,preview:a.preview},null,8,["onAdd","added","index","cover","artist","title","source","preview"]))),128))])),s("div",Te,[s("button",{onClick:e[12]||(e[12]=(...a)=>i.addAll&&i.addAll(...a)),class:"negative"},"Add All")])])]),_:1},8,["onClick","modelValue"])])}var Oe=w(se,[["render",Me],["__scopeId","data-v-0d14bb02"]]);const Ve={name:"ReleaseItem",components:{AddAlbumToPlaylist:Oe},methods:{redirect(){this.$refs.addAlbum.showModal=!0}},props:{cover:String,title:String,artist:String,href:String,releaseDate:String,userData:Object}},Be={class:"wrapper"},Fe=["src"],je={key:0,class:"note"};function Re(t,e,l,u,o,i){var c;const p=h("add-album-to-playlist");return r(),d("div",Be,[g(p,{id:(c=this.href)==null?void 0:c.replace("https://open.spotify.com/album/",""),userData:l.userData,cover:l.cover,title:l.title,artist:l.artist,href:l.href,ref:"addAlbum"},null,8,["id","userData","cover","title","artist","href"]),s("div",{class:"item",onClick:e[0]||(e[0]=(...y)=>i.redirect&&i.redirect(...y))},[s("img",{src:l.cover},null,8,Fe),s("h4",null,_(l.title),1),s("p",null,_(l.artist),1),l.releaseDate?(r(),d("p",je,"Released on "+_(l.releaseDate),1)):b("",!0)])])}var $e=w(Ve,[["render",Re],["__scopeId","data-v-41d778a4"]]);const He={name:"ReleaseItemBig",methods:{redirect(){this.$refs.addAlbum.showModal=!0}},props:{cover:String,title:String,artist:String,href:String,releaseDate:String}},Ue={class:"itemBig"},xe=["src"],Je={class:"wrapper"},Ee={key:0,class:"note"};function qe(t,e,l,u,o,i){return r(),d("div",Ue,[s("div",{class:"item",onClick:e[0]||(e[0]=(...p)=>i.redirect&&i.redirect(...p))},[s("img",{src:l.cover},null,8,xe),s("div",Je,[s("h4",null,_(l.title),1),s("p",null,_(l.artist),1),l.releaseDate?(r(),d("p",Ee,"Released on "+_(l.releaseDate),1)):b("",!0)])])])}var ze=w(He,[["render",qe],["__scopeId","data-v-6b1e6eed"]]);const Le={components:{CollectionHeader:$,FullShelf:V,Item:$e,ItemBig:ze},name:"Releases",props:{authorised:Boolean,userData:Object},data(){return{outSoon:[],outNow:[],outAlready:[]}},methods:{load(t){const e=new Date;for(const l of t){const u=new Date(l.releaseDate);e<u?this.outSoon.push(l):e.getMonth()==u.getMonth()&&e.getDate()==u.getDate()&&e.getFullYear()==u.getFullYear()?this.outNow.push(l):this.outAlready.push(l)}}},mounted(){var l,u;const t="apollo.releaseCache",e=window.localStorage.getItem(t);if(!window.location.hash&&((l=this.userData.data)==null?void 0:l.spotifyApiId)&&((u=this.userData.data)==null?void 0:u.spotifyApiSecret)){const o=window.location.href,i="user-follow-read playlist-modify-public";window.location.href=`https://accounts.spotify.com/authorize?client_id=${this.userData.data.spotifyApiId}&redirect_uri=${o.replace("#","%23")}&scope=${i}&response_type=token&state=123`;return}e&&new Date-new Date(JSON.parse(e).requested)<30*60*1e3?this.load(JSON.parse(e).data):window.location.hash&&fetch("/spotify/releaseRadar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:window.location.hash.split("=")[1]})}).then(o=>o.json()).then(o=>{window.localStorage.setItem(t,JSON.stringify({requested:new Date,data:o})),this.load(o)})}},Ye={class:"padding-20"},Ge={class:"releases"};function Ke(t,e,l,u,o,i){const p=h("CollectionHeader"),c=h("item-big"),y=h("full-shelf"),I=h("ItemBig"),P=h("Item");return r(),d("div",Ye,[g(p,{onToggleFullSidebar:e[0]||(e[0]=()=>t.$emit("toggleFullSidebar"))}),s("div",Ge,[o.outSoon.length?(r(),f(y,{key:0,heading:"Out Soon"},{default:S(()=>[(r(!0),d(A,null,k(o.outSoon,n=>(r(),f(c,{key:n.url,userData:l.userData,releaseDate:n.releaseDate,cover:n.cover,href:n.url,artist:n.artists.join(", "),title:n.title},null,8,["userData","releaseDate","cover","href","artist","title"]))),128))]),_:1})):b("",!0),o.outNow.length?(r(),f(y,{key:1,heading:"Out Now"},{default:S(()=>[(r(!0),d(A,null,k(o.outNow,n=>(r(),f(I,{key:n.url,userData:l.userData,releaseDate:n.releaseDate,cover:n.cover,href:n.url,artist:n.artists.join(", "),title:n.title},null,8,["userData","releaseDate","cover","href","artist","title"]))),128))]),_:1})):b("",!0),o.outAlready.length?(r(),f(y,{key:2,heading:"Releases"},{default:S(()=>[(r(!0),d(A,null,k(o.outAlready,n=>(r(),f(P,{key:n.url,userData:l.userData,releaseDate:n.releaseDate,cover:n.cover,href:n.url,artist:n.artists.join(", "),title:n.title},null,8,["userData","releaseDate","cover","href","artist","title"]))),128))]),_:1})):b("",!0)])])}var et=w(Le,[["render",Ke],["__scopeId","data-v-ca162fe0"]]);export{et as default};
