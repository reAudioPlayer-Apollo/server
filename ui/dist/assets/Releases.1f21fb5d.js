import{F as V}from"./FullShelf.128abd6d.js";import{_ as w,o as r,c as d,a as l,t as m,h as b,M as B,r as h,j as y,n as C,p as T,b as N,k as F,e as S,w as f,l as x,F as A,g as k,v as D,d as g,f as R}from"./index.dbf45948.js";import{F as E}from"./FindSources.1cb88bc4.js";import{C as H}from"./CollectionHeader.65b21b21.js";const U={name:"MiniPlayer",props:{src:String,artist:String,title:String,display:{type:Boolean,default:!0}},data(){return{playing:!1}},methods:{get(t){fetch(`/api/${t}`)},pause(){this.get("pause")},play(){this.get("play")},playPause(){const t=new CustomEvent("player.play",{detail:{title:this.title,artist:this.artist,source:this.src}});window.dispatchEvent(t)}}},J={class:"miniPlayer"},q=["src"];function z(t,e,s,u,o,i){return r(),d("div",J,[l("audio",{src:s.src,ref:"player"},null,8,q),s.display?(r(),d("span",{key:0,onClick:e[0]||(e[0]=(...p)=>i.playPause&&i.playPause(...p)),class:"material-symbols-rounded circle"},m(o.playing?"pause":"play_arrow"),1)):b("",!0)])}var L=w(U,[["render",z],["__scopeId","data-v-627e71ce"]]);const Y={components:{MiniPlayer:L,Marquee:B},name:"AlbumEntry",props:{index:Number,id:Number,source:String,artist:{type:String,default:"N/A"},title:{type:String,default:"N/A"},added:Boolean,preview:String},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks",hovering:!1}},methods:{remove(){fetch("/api/remove",{method:"POST",body:JSON.stringify({playlistId:Number(this.$route.params.id),songId:this.id})})},onselect(){this.highlighted=!this.highlighted},playAt(){this.$emit("edit",this.index)},add(){console.log("add"),this.$emit("add",this.index)}},watch:{added(){console.log("change"),this.$refs.add.innerHTML=this.added?"done":"add"}}},G={class:"track"},K={class:"trackwrapper"};function Q(t,e,s,u,o,i){const p=h("mini-player"),_=h("Marquee");return r(),d("div",{onDblclick:e[2]||(e[2]=()=>{i.playAt(),i.onselect()}),onClick:e[3]||(e[3]=(...c)=>i.onselect&&i.onselect(...c)),onMouseover:e[4]||(e[4]=c=>o.hovering=!0),onMouseleave:e[5]||(e[5]=c=>o.hovering=!1),class:C(["albumEntry",{selected:o.highlighted}])},[y(p,{class:C(["miniPlayer",{hidden:!o.hovering}]),title:s.title,artist:s.artist,src:s.source},null,8,["class","title","artist","src"]),o.hovering?b("",!0):(r(),d("span",{key:0,onClick:e[0]||(e[0]=(...c)=>t.edit&&t.edit(...c)),class:"id"},m(s.index+1),1)),l("div",G,[l("div",K,[l("span",{class:C(["title",{playing:t.playing}])},[y(_,{text:s.title},null,8,["text"])],2),l("span",{class:C(["artist",{playing:t.playing}])},[y(_,{text:s.artist},null,8,["text"])],2)])]),l("span",{onClick:e[1]||(e[1]=(...c)=>i.add&&i.add(...c)),class:"material-symbols-rounded edit",ref:"add"},"add",512)],34)}var W=w(Y,[["render",Q],["__scopeId","data-v-1075abee"]]);const X={name:"AlbumHeader"},O=t=>(T("data-v-1a51c33d"),t=t(),N(),t),Z={class:"gridHeader"},$=O(()=>l("span",{class:"id"},"#",-1)),ee=O(()=>l("span",{class:"title"},"Title",-1)),te=[$,ee];function se(t,e,s,u,o,i){return r(),d("div",Z,te)}var le=w(X,[["render",se],["__scopeId","data-v-1a51c33d"]]);const ae={name:"AddAlbumToPlaylist",components:{FindSources:E,AlbumEntry:W,AlbumHeader:le},props:{cover:String,artist:String,title:String,href:String,id:String,userData:Object},data(){return{showModal:!1,selectedPlaylist:-1,playlist:[],editSong:!1}},computed:{playlists(){var t,e;return(((e=(t=this.userData)==null?void 0:t.data)==null?void 0:e.playlists)||[]).map(s=>s==null?void 0:s.name)}},methods:{share(){window.open(this.href)},preview(){console.log(this.href);const t=new CustomEvent("player.play",{detail:{artist:this.artist,title:this.title,source:this.href}});window.dispatchEvent(t)},close(){this.showModal=!1,this.$emit("close")},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")},addAll(){for(let t=0;t<this.playlist.length;t++)this.add(t)},add(t){const e=this.playlist[t],s=this.playlists.findIndex(u=>u==this.selectedPlaylist);if(console.log(e,s),s<0){alert("no playlist selected");return}this.userData.data.playlists[s].songs.push({source:e.src,title:e.title,artist:e.artists.join(", "),album:this.title,cover:this.cover,duration:"-1:59"}),fetch("/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.userData.data)}).then(u=>{console.log(u),this.$emit("close")}),e.added=!0}},watch:{showModal(){!this.showModal||fetch("/spotify/album",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:window.location.hash.split("=")[1],albumId:this.id})}).then(t=>t.json()).then(t=>{this.playlist.length=0,this.playlist.push(...t)})}}},v=t=>(T("data-v-131c2e56"),t=t(),N(),t),ie={class:"wrapper"},oe={class:"header"},re=v(()=>l("h3",null,"Add album",-1)),ne=v(()=>l("span",{class:"material-symbols-rounded"}," close ",-1)),de=[ne],ue=v(()=>l("h4",null,"To Playlist",-1)),ce=v(()=>l("br",null,null,-1)),he={key:0},_e=v(()=>l("h4",null,"Source",-1)),pe={class:"content"},me=v(()=>l("h4",null,"Title",-1)),ve={class:"content"},ye=v(()=>l("h4",null,"Album",-1)),fe={class:"content"},ge=v(()=>l("h4",null,"Artist",-1)),be={class:"content"},we=v(()=>l("h4",null,"Cover",-1)),Se={class:"content"},De=["src"],Ae={class:"confirm"},ke={key:1},Ce=["src"],Ie={class:"details"},Me={class:"detailswrapper"},Pe=R("Album"),Te=v(()=>l("hr",{class:"hideIfMobile"},null,-1)),Ne=v(()=>l("hr",null,null,-1)),Oe={class:"confirm"};function je(t,e,s,u,o,i){const p=h("FindSources"),_=h("h7"),c=h("album-header"),I=h("album-entry"),M=h("vue-final-modal"),n=F("observe-visibility");return r(),d("div",null,[y(M,{onClick:t.hideFindSourcesCtx,modelValue:o.showModal,"onUpdate:modelValue":e[14]||(e[14]=a=>o.showModal=a),classes:"modal-containerr","content-class":"addAlbumToPlaylistPopup"},{default:S(()=>[l("div",ie,[l("div",oe,[re,l("button",{class:"modal-close",onClick:e[0]||(e[0]=(...a)=>i.close&&i.close(...a))},de)]),ue,f(l("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.selectedPlaylist=a)},[(r(!0),d(A,null,k(i.playlists,a=>(r(),d("option",{key:a},m(a),1))),128))],512),[[x,o.selectedPlaylist]]),ce,o.editSong?(r(),d("div",he,[_e,y(p,{ref:"findSources",title:s.title,artist:s.artist},{default:S(()=>[l("div",pe,[f(l("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>t.dSource=a),ref:"source"},null,512),[[D,t.dSource]]),l("span",{class:"material-symbols-rounded more",ref:"sourceMore",onClick:e[3]||(e[3]=(...a)=>t.opencontextmenu&&t.opencontextmenu(...a))},"more_vert",512)])]),_:1},8,["title","artist"]),me,l("div",ve,[f(l("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>t.dTitle=a),type:"text"},null,512),[[D,t.dTitle]])]),ye,l("div",fe,[f(l("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>t.dAlbum=a),type:"text",ref:"album"},null,512),[[D,t.dAlbum]])]),ge,l("div",be,[f(l("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>t.dArtist=a),type:"text"},null,512),[[D,t.dArtist]])]),we,l("div",Se,[f(l("input",{type:"text",class:"addSong cover","onUpdate:modelValue":e[7]||(e[7]=a=>t.dCover=a),ref:"cover"},null,512),[[D,t.dCover]]),l("img",{onClick:e[8]||(e[8]=(...a)=>i.openInNewTab&&i.openInNewTab(...a)),class:"addSong cover",src:t.dCover?t.dCover:"/assets/img/music_placeholder.png"},null,8,De)]),l("div",Ae,[l("button",{onClick:e[9]||(e[9]=(...a)=>i.add&&i.add(...a)),class:"negative"},"Add")])])):(r(),d("div",ke,[f((r(),d("div",{class:"padding-20 playlisteditor",onClick:e[12]||(e[12]=(...a)=>t.editPlaylist&&t.editPlaylist(...a))},[l("img",{class:"cover",src:s.cover},null,8,Ce),l("div",Ie,[l("div",Me,[y(_,{class:"hideIfMobile"},{default:S(()=>[Pe]),_:1}),l("span",{class:"material-symbols-rounded share",onClick:e[10]||(e[10]=(...a)=>i.share&&i.share(...a))},"share"),l("span",{class:"material-symbols-rounded share fill",onClick:e[11]||(e[11]=(...a)=>i.preview&&i.preview(...a))},"play_arrow")]),l("h1",null,m(s.title),1),l("h5",null,m(s.artist),1)])])),[[n,t.headerVisibilityChanged]]),Te,y(c,{class:"hideIfMobile"}),Ne,(r(!0),d(A,null,k(o.playlist,(a,P)=>(r(),g(I,{onAdd:i.add,key:P,added:a.added,index:P,cover:a.cover,artist:a.artists.join(", "),title:a.title,source:a.src,preview:this.href},null,8,["onAdd","added","index","cover","artist","title","source","preview"]))),128))])),l("div",Oe,[l("button",{onClick:e[13]||(e[13]=(...a)=>i.addAll&&i.addAll(...a)),class:"negative"},"Add All")])])]),_:1},8,["onClick","modelValue"])])}var j=w(ae,[["render",je],["__scopeId","data-v-131c2e56"]]);const Ve={name:"ReleaseItem",components:{AddAlbumToPlaylist:j},methods:{redirect(){this.$refs.addAlbum.showModal=!0}},props:{cover:String,title:String,artist:String,href:String,releaseDate:String,userData:Object}},Be={class:"wrapper"},Fe=["src"],xe={key:0,class:"note"};function Re(t,e,s,u,o,i){var _;const p=h("add-album-to-playlist");return r(),d("div",Be,[y(p,{id:(_=this.href)==null?void 0:_.replace("https://open.spotify.com/album/",""),userData:s.userData,cover:s.cover,title:s.title,artist:s.artist,href:s.href,ref:"addAlbum"},null,8,["id","userData","cover","title","artist","href"]),l("div",{class:"item",onClick:e[0]||(e[0]=(...c)=>i.redirect&&i.redirect(...c))},[l("img",{src:s.cover},null,8,Fe),l("h4",null,m(s.title),1),l("p",null,m(s.artist),1),s.releaseDate?(r(),d("p",xe,"Released on "+m(s.releaseDate),1)):b("",!0)])])}var Ee=w(Ve,[["render",Re],["__scopeId","data-v-62a04f5a"]]);const He={name:"ReleaseItemBig",components:{AddAlbumToPlaylist:j},methods:{redirect(){this.$refs.addAlbum.showModal=!0}},props:{cover:String,title:String,artist:String,href:String,releaseDate:String,userData:Object}},Ue={class:"itemBig"},Je=["src"],qe={class:"wrapper"},ze={key:0,class:"note"};function Le(t,e,s,u,o,i){var _;const p=h("add-album-to-playlist");return r(),d("div",Ue,[y(p,{id:(_=this.href)==null?void 0:_.replace("https://open.spotify.com/album/",""),userData:s.userData,cover:s.cover,title:s.title,artist:s.artist,href:s.href,ref:"addAlbum"},null,8,["id","userData","cover","title","artist","href"]),l("div",{class:"item",onClick:e[0]||(e[0]=(...c)=>i.redirect&&i.redirect(...c))},[l("img",{src:s.cover},null,8,Je),l("div",qe,[l("h4",null,m(s.title),1),l("p",null,m(s.artist),1),s.releaseDate?(r(),d("p",ze,"Released on "+m(s.releaseDate),1)):b("",!0)])])])}var Ye=w(He,[["render",Le],["__scopeId","data-v-7605b6bd"]]);const Ge={components:{CollectionHeader:H,FullShelf:V,Item:Ee,ItemBig:Ye},name:"Releases",props:{authorised:Boolean,userData:Object},data(){return{outSoon:[],outNow:[],outAlready:[]}},methods:{load(t){const e=new Date;for(const s of t){const u=new Date(s.releaseDate);e<u?this.outSoon.push(s):e.getMonth()==u.getMonth()&&e.getDate()==u.getDate()&&e.getFullYear()==u.getFullYear()?this.outNow.push(s):this.outAlready.push(s)}}},mounted(){var s,u;const t="apollo.releaseCache",e=window.localStorage.getItem(t);if(!window.location.hash&&((s=this.userData.data)==null?void 0:s.spotifyApiId)&&((u=this.userData.data)==null?void 0:u.spotifyApiSecret)){const o=window.location.href,i="user-follow-read playlist-modify-public";window.location.href=`https://accounts.spotify.com/authorize?client_id=${this.userData.data.spotifyApiId}&redirect_uri=${o.replace("#","%23")}&scope=${i}&response_type=token&state=123`;return}e&&new Date-new Date(JSON.parse(e).requested)<30*60*1e3?this.load(JSON.parse(e).data):window.location.hash&&fetch("/spotify/releaseRadar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:window.location.hash.split("=")[1]})}).then(o=>o.json()).then(o=>{window.localStorage.setItem(t,JSON.stringify({requested:new Date,data:o})),this.load(o)})}},Ke={class:"padding-20"},Qe={class:"releases"};function We(t,e,s,u,o,i){const p=h("CollectionHeader"),_=h("item-big"),c=h("full-shelf"),I=h("ItemBig"),M=h("Item");return r(),d("div",Ke,[y(p,{onToggleFullSidebar:e[0]||(e[0]=()=>t.$emit("toggleFullSidebar"))}),l("div",Qe,[o.outSoon.length?(r(),g(c,{key:0,heading:"Out Soon"},{default:S(()=>[(r(!0),d(A,null,k(o.outSoon,n=>(r(),g(_,{key:n.url,userData:s.userData,releaseDate:n.releaseDate,cover:n.cover,href:n.url,artist:n.artists.join(", "),title:n.title},null,8,["userData","releaseDate","cover","href","artist","title"]))),128))]),_:1})):b("",!0),o.outNow.length?(r(),g(c,{key:1,heading:"Out Now"},{default:S(()=>[(r(!0),d(A,null,k(o.outNow,n=>(r(),g(I,{key:n.url,userData:s.userData,releaseDate:n.releaseDate,cover:n.cover,href:n.url,artist:n.artists.join(", "),title:n.title},null,8,["userData","releaseDate","cover","href","artist","title"]))),128))]),_:1})):b("",!0),o.outAlready.length?(r(),g(c,{key:2,heading:"Releases"},{default:S(()=>[(r(!0),d(A,null,k(o.outAlready,n=>(r(),g(M,{key:n.url,userData:s.userData,releaseDate:n.releaseDate,cover:n.cover,href:n.url,artist:n.artists.join(", "),title:n.title},null,8,["userData","releaseDate","cover","href","artist","title"]))),128))]),_:1})):b("",!0)])])}var tt=w(Ge,[["render",We],["__scopeId","data-v-ca162fe0"]]);export{tt as default};
