import{_ as g,o as _,c as y,p as C,i as N,a as s,r as u,t as b,h as a,j as A,k as v,g as O,w as c,e as x,b as T,f as k,n as f,v as S,H as D,F,d as B}from"./index.fc236a89.js";const L={name:"GridHeader"},M=e=>(C("data-v-50c56ea2"),e=e(),N(),e),J={class:"gridHeader"},R=M(()=>s("span",{class:"id"},"#",-1)),j=M(()=>s("span",{class:"title"},"Title",-1)),Y=M(()=>s("span",{class:"album"},"Album",-1)),W=M(()=>s("span",{class:"clock material-symbols-rounded"},"schedule",-1)),z=[R,j,Y,W];function G(e,t,l,h,o,i){return _(),y("div",J,z)}var q=g(L,[["render",G],["__scopeId","data-v-50c56ea2"]]);const X={name:"FixedPlaylistHeader",components:{GridHeader:q},props:{title:String}},K={class:"fixedPlaylistHeader"},Q={class:"upperWrapper"};function Z(e,t,l,h,o,i){const r=u("grid-header");return _(),y("div",K,[s("div",Q,[s("span",{id:"loadPlaylist",onClick:t[0]||(t[0]=d=>this.$emit("loadPlaylist")),class:"material-symbols-rounded"},"play_circle_filled"),s("h3",null,b(l.title),1)]),a(r,{class:"padding-20 darkback"})])}var tt=g(X,[["render",Z],["__scopeId","data-v-3a0a219e"]]);const et={name:"SongCtx",props:{liked:Boolean,isAutoPlaylist:Boolean},data(){return{playlists:[]}},methods:{hide(){this.$refs.contextmenu.hide()},show(e){const t=this.$refs.box.getBoundingClientRect(),l={top:t.height+t.top+window.scrollY,left:t.width+t.left+window.scrollX};this.$refs.contextmenu.show(l),e==null||e.stopPropagation()},like(){this.$emit("like")},remove(){this.$emit("remove")},addto(e){if(e==="new"){fetch("/api/playlist/create").then(t=>t.text()).then(t=>{this.$emit("addto",Number(t.replace("/playlist/","")))});return}this.$emit("addto",e)},download(){this.$emit("download")},update(){this.$emit("update")}}},st={ref:"box"},it=x("Remove from this playlist"),ot=x("Update Metadata");function lt(e,t,l,h,o,i){const r=u("v-contextmenu-item"),d=u("v-contextmenu-divider");u("v-contextmenu-submenu");const n=u("v-contextmenu"),w=A("contextmenu");return v((_(),y("div",st,[O(e.$slots,"default"),a(n,{ref:"contextmenu"},{default:c(()=>[a(r,{onClick:i.like},{default:c(()=>[x(b((l.liked?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1},8,["onClick"]),l.isAutoPlaylist?k("",!0):(_(),T(r,{key:0,onClick:i.remove},{default:c(()=>[it]),_:1},8,["onClick"])),k("",!0),a(d),a(r,{onClick:i.update},{default:c(()=>[ot]),_:1},8,["onClick"])]),_:1},512)])),[[w,void 0,"contextmenu"]])}var nt=g(et,[["render",lt]]);const at={name:"Marquee",mounted(){this.update(),window.addEventListener("resize",this.update)},data(){return{isMarquee:!1}},methods:{isTruncated(e){return e.scrollWidth>e.clientWidth},update(){this.isMarquee=!1,setTimeout(()=>{this.isMarquee=this.isTruncated(this.$refs.marquee)},10)}},props:{text:String},watch:{text(){this.update()}}},dt={key:0,class:"replacer"},rt={key:0,class:"overlay"};function ut(e,t,l,h,o,i){return _(),y("div",{class:f(["marqueeWrapper",{marquee:o.isMarquee}])},[s("span",{ref:"marquee",class:f({marquee:o.isMarquee})},[x(b(l.text)+" ",1),o.isMarquee?(_(),y("span",dt,b(l.text),1)):k("",!0)],2),o.isMarquee?(_(),y("div",rt)):k("",!0)],2)}var ct=g(at,[["render",ut],["__scopeId","data-v-bf0ff45e"]]);const ht={name:"FindSources",props:{artist:String,title:String},methods:{hide(){this.$refs.contextmenu.hide()},show(e){const t=this.$refs.box.getBoundingClientRect(),l={top:t.height+t.top+window.scrollY,left:t.width+t.left+window.scrollX};this.$refs.contextmenu.show(l),e==null||e.stopPropagation()},openSoundcloud(){window.open(`https://soundcloud.com/search?q=${this.artist} ${this.title}`)},openAudius(){window.open(`https://audius.co/search/${this.artist} ${this.title}`)},openYoutubeMusic(){window.open(`https://music.youtube.com/search?q=${this.artist} ${this.title}`)},openSpotify(){window.open(`https://open.spotify.com/search/${this.artist} ${this.title}`)}}},pt={ref:"box"},_t=x("Soundcloud"),mt=x("Audius"),yt=x("Youtube Music"),ft=x("Spotify");function vt(e,t,l,h,o,i){const r=u("v-contextmenu-item"),d=u("v-contextmenu-submenu"),n=u("v-contextmenu"),w=A("contextmenu");return v((_(),y("div",pt,[O(e.$slots,"default"),a(n,{ref:"contextmenu"},{default:c(()=>[a(d,{title:"Search on"},{default:c(()=>[a(r,{onClick:i.openSoundcloud},{default:c(()=>[_t]),_:1},8,["onClick"]),a(r,{onClick:i.openAudius},{default:c(()=>[mt]),_:1},8,["onClick"]),a(r,{onClick:i.openYoutubeMusic},{default:c(()=>[yt]),_:1},8,["onClick"]),a(r,{onClick:i.openSpotify},{default:c(()=>[ft]),_:1},8,["onClick"])]),_:1})]),_:1},512)])),[[w,void 0,"contextmenu"]])}var gt=g(ht,[["render",vt]]);const xt={name:"EditSong",components:{FindSources:gt},props:{cover:String,album:String,artist:String,source:String,title:String,id:Number,userData:Object},data(){return{showModal:!1,dCover:this.cover,dAlbum:this.album,dArtist:this.artist,dTitle:this.title,dSource:this.source}},methods:{opencontextmenu(e){this.$refs.findSourcesEdit.show(e)},hideFindSourcesCtx(){this.$refs.findSourcesEdit.hide()},add(){this.showModal=!1,console.log(this.userData);for(const e of this.userData.data.playlists)for(const t of e.songs)t.id==this.id&&(console.log("found one"),t.source=this.dSource,t.title=this.dTitle,t.album=this.dAlbum,t.artist=this.dArtist,t.cover=this.dCover);fetch("/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.userData.data)}).then(e=>{console.log(e),this.$emit("close")})},loadMetadata(){},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}},watch:{id(){this.dCover=this.cover,this.dAlbum=this.album,this.dArtist=this.artist,this.dTitle=this.title,this.dSource=this.source}}},P=e=>(C("data-v-90cdf3f2"),e=e(),N(),e),bt={class:"wrapper"},wt={class:"header"},St=P(()=>s("h3",null,"Edit song",-1)),Pt=P(()=>s("span",{class:"material-symbols-rounded"}," close ",-1)),kt=[Pt],Ct=P(()=>s("h4",null,"Source",-1)),Nt={class:"content"},Dt=P(()=>s("h4",null,"Title",-1)),Mt={class:"content"},It=P(()=>s("h4",null,"Album",-1)),$t={class:"content"},At=P(()=>s("h4",null,"Artist",-1)),Tt={class:"content"},Ot=P(()=>s("h4",null,"Cover",-1)),qt={class:"content"},Et=["src"],Ht={class:"confirm"};function Vt(e,t,l,h,o,i){const r=u("FindSources"),d=u("vue-final-modal");return _(),y("div",null,[a(d,{onClick:i.hideFindSourcesCtx,modelValue:o.showModal,"onUpdate:modelValue":t[9]||(t[9]=n=>o.showModal=n),classes:"modal-container","content-class":"modal-content"},{default:c(()=>[s("div",bt,[s("div",wt,[St,s("button",{class:"modal-close",onClick:t[0]||(t[0]=n=>o.showModal=!1)},kt)]),Ct,a(r,{ref:"findSourcesEdit",title:l.title,artist:l.artist},{default:c(()=>[s("div",Nt,[v(s("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>o.dSource=n),type:"text",ref:"source"},null,512),[[S,o.dSource]]),s("span",{class:"material-symbols-rounded more",ref:"sourceMore",onClick:t[2]||(t[2]=(...n)=>i.opencontextmenu&&i.opencontextmenu(...n))},"more_vert",512)])]),_:1},8,["title","artist"]),Dt,s("div",Mt,[v(s("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>o.dTitle=n),type:"text"},null,512),[[S,o.dTitle]])]),It,s("div",$t,[v(s("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>o.dAlbum=n),type:"text",ref:"album"},null,512),[[S,o.dAlbum]])]),At,s("div",Tt,[v(s("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>o.dArtist=n),type:"text"},null,512),[[S,o.dArtist]])]),Ot,s("div",qt,[v(s("input",{type:"text",class:"addSong cover","onUpdate:modelValue":t[6]||(t[6]=n=>o.dCover=n),ref:"cover"},null,512),[[S,o.dCover]]),s("img",{onClick:t[7]||(t[7]=(...n)=>i.openInNewTab&&i.openInNewTab(...n)),class:"addSong cover",src:l.cover?l.cover:"/assets/img/music_placeholder.png"},null,8,Et)]),s("div",Ht,[s("button",{onClick:t[8]||(t[8]=(...n)=>i.add&&i.add(...n)),class:"negative"},"Save")])])]),_:1},8,["onClick","modelValue"])])}var Ut=g(xt,[["render",Vt],["__scopeId","data-v-90cdf3f2"]]);const Ft=new D("reapOne.track",22),Bt=new D("reapOne.playlist",22),Lt={name:"PlaylistEntry",components:{SongCtx:nt,Marquee:ct,EditSong:Ut},props:{index:Number,id:Number,source:String,artist:{type:String,default:"N/A"},cover:{type:String,default:"/assets/img/music_placeholder.png"},title:{type:String,default:"N/A"},album:{type:String,default:"N/A"},duration:{type:String,default:"N/A"},favourite:{type:Boolean,default:!1},playing:{type:Boolean,default:!1},userData:Object},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks"}},computed:{trackId(){return Ft.encode(this.id)}},methods:{getPlaylistId(){return Bt.decode(this.$route.params.id)},download(){this.$emit("download",this.index)},addToPlaylist(e){fetch("/api/add",{method:"POST",body:JSON.stringify({id:e,source:this.source})}).then(t=>{t.status==200&&this.$emit("requestUpdate")})},remove(){fetch("/api/remove",{method:"POST",body:JSON.stringify({playlistId:Number(this.getPlaylistId()),songId:this.id})}).then(e=>{e.status==200&&this.$emit("requestUpdate")})},update(){this.$refs.editSongPopup.showModal=!0},hideCtxMenu(){this.$refs.ctxMenu.hide()},showCtxMenu(e){console.log("show"),this.$refs.ctxMenu.show(e)},onselect(){this.highlighted=!this.highlighted,this.hideCtxMenu()},displayPlay(){const e=this.$refs.idOrPlay;e.innerHTML="play_arrow",e.classList.add("material-symbols-rounded")},displayId(){const e=this.$refs.idOrPlay;e.innerHTML=this.index+1,e.classList.remove("material-symbols-rounded")},playAt(){console.log(this.$route.path);const e={index:this.index};this.$route.path.includes("/playlist/")&&(e.playlistIndex=Number(this.getPlaylistId())),this.$route.path.includes("/collection/tracks")&&(e.type="collection"),fetch("/api/at",{method:"POST",body:JSON.stringify(e)})},setFavourite(){fetch("/api/updateSong",{method:"POST",body:JSON.stringify({id:this.id,favourite:this.favourited,album:this.album,artist:this.artist,title:this.title,duration:this.duration,cover:this.cover,source:this.source})})}},watch:{favourited(){this.setFavourite()},favourite(){console.log("mounted",this.title,this.favourite,this.favourited),this.favourited=this.favourite,this.highlighted=!1}}},Jt={class:"track"},Rt=["src"],jt={class:"trackwrapper"},Yt={class:"duration"};function Wt(e,t,l,h,o,i){const r=u("EditSong"),d=u("Marquee"),n=u("router-link"),w=u("SongCtx");return _(),T(w,{onDownload:i.download,onAddto:i.addToPlaylist,onRemove:i.remove,onUpdate:i.update,onLike:t[7]||(t[7]=m=>o.favourited=!o.favourited),isAutoPlaylist:o.isAutoPlaylist,liked:o.favourited,ref:"ctxMenu"},{default:c(()=>[a(r,{userData:l.userData,onClose:e.updatePlaylist,ref:"editSongPopup",cover:l.cover,id:l.id,title:l.title,album:l.album,artist:l.artist,source:l.source},null,8,["userData","onClose","cover","id","title","album","artist","source"]),s("div",{onDblclick:t[3]||(t[3]=()=>{i.playAt(),i.onselect()}),onClick:t[4]||(t[4]=(...m)=>i.onselect&&i.onselect(...m)),onMouseover:t[5]||(t[5]=(...m)=>i.displayPlay&&i.displayPlay(...m)),onMouseleave:t[6]||(t[6]=(...m)=>i.displayId&&i.displayId(...m)),class:f(["playlistEntry",{selected:o.highlighted}])},[s("span",{onClick:t[0]||(t[0]=(...m)=>i.playAt&&i.playAt(...m)),ref:"idOrPlay",class:f([{playing:l.playing},"id"])},b(l.index+1),3),s("div",Jt,[s("img",{src:l.cover||"/assets/img/music_placeholder.png"},null,8,Rt),s("div",jt,[s("span",{class:f(["title",{playing:l.playing}])},[a(n,{class:"linkOnHover",to:`/track/${i.trackId}`},{default:c(()=>[a(d,{text:l.title},null,8,["text"])]),_:1},8,["to"])],2),s("span",{class:f(["artist",{playing:l.playing}])},[a(n,{class:"linkOnHover",to:`/search/${l.artist}`},{default:c(()=>[a(d,{text:l.artist},null,8,["text"])]),_:1},8,["to"])],2)])]),s("span",{class:f(["album",{playing:l.playing}])},[a(d,{text:l.album},null,8,["text"])],2),s("span",{onClick:t[1]||(t[1]=m=>o.favourited=!o.favourited),class:f(["favourite material-symbols-rounded",{showfavourite:o.favourited||o.highlighted,active:o.favourited}])},"favorite",2),s("span",Yt,b(l.duration),1),s("span",{onClick:t[2]||(t[2]=(...m)=>i.showCtxMenu&&i.showCtxMenu(...m)),class:f(["more material-symbols-rounded",{hidden:!o.highlighted}])},"more_horiz",2)],34)]),_:1},8,["onDownload","onAddto","onRemove","onUpdate","isAutoPlaylist","liked"])}var zt=g(Lt,[["render",Wt],["__scopeId","data-v-134ec9a3"]]);const $=new D("reapOne.playlist",22),Gt={name:"EditPlaylist",props:{playlistName:String,playlistDescription:String,userData:Object},data(){return{showModal:!1,cover:"",name:this.playlistName,description:this.playlistDescription}},methods:{apply(){this.showModal=!1,console.log("fetch"),this.userData.data.playlists[Number($.decode(this.$route.params.id))].name=this.name,this.userData.data.playlists[Number($.decode(this.$route.params.id))].description=this.description,fetch("/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.userData.data)}).then(e=>{console.log(e),this.$emit("close")})},remove(){this.userData.data.playlists.splice(Number($.decode(this.$route.params.id)),1),fetch("/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.userData.data)}).then(e=>{console.log(e),this.$emit("close")})}},watch:{playlistName(){this.name=this.playlistName},playlistDescription(){this.description=this.playlistDescription}}},I=e=>(C("data-v-da852f16"),e=e(),N(),e),Xt={class:"wrapper"},Kt={class:"header"},Qt=I(()=>s("h3",null,"Edit details",-1)),Zt=I(()=>s("span",{class:"material-symbols-rounded"}," close ",-1)),te=[Zt],ee=I(()=>s("h4",null,"Name",-1)),se={class:"content"},ie=I(()=>s("h4",null,"Description",-1)),oe={class:"content"},le={class:"confirm"};function ne(e,t,l,h,o,i){const r=u("vue-final-modal");return _(),y("div",null,[a(r,{modelValue:o.showModal,"onUpdate:modelValue":t[5]||(t[5]=d=>o.showModal=d),classes:"modal-container","content-class":"modal-content"},{default:c(()=>[s("div",Xt,[s("div",Kt,[Qt,s("button",{class:"modal-close",onClick:t[0]||(t[0]=d=>o.showModal=!1)},te)]),ee,s("div",se,[v(s("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>o.name=d),type:"text",ref:"name"},null,512),[[S,o.name]])]),ie,s("div",oe,[v(s("input",{"onUpdate:modelValue":t[2]||(t[2]=d=>o.description=d),type:"text",ref:"description"},null,512),[[S,o.description]])]),s("div",le,[s("button",{onClick:t[3]||(t[3]=(...d)=>i.remove&&i.remove(...d)),class:"negative left"},"Delete"),s("button",{onClick:t[4]||(t[4]=(...d)=>i.apply&&i.apply(...d)),class:"negative"},"Save")])])]),_:1},8,["modelValue"])])}var ae=g(Gt,[["render",ne],["__scopeId","data-v-da852f16"]]);const de=new D("reapOne.playlist",22),re={components:{PlaylistEntry:zt,FixedPlaylistHeader:tt,GridHeader:q,EditPlaylist:ae},name:"Playlist",props:{authorised:Boolean,userData:Object},data(){var o,i,r;if(this.updatePlaylist(),!this.getId()||!this.$route.path.includes("/playlist/"))return;const e=(r=(i=(o=this.userData)==null?void 0:o.data)==null?void 0:i.playlists)==null?void 0:r[Number(this.getId())];document.title=`${this.playlistName} - reAudioPlayer One`,console.log(e.songs);const t=e.songs,l=e.name,h=e.description;return{fixedHeaderHidden:!0,playlist:t,playlistName:l,playlistDescription:h}},methods:{getId(){return de.decode(this.$route.params.id)},download(e){var l;const t=(l=this.playlist)==null?void 0:l[e];window.open("/api/download/"+t.id)},updatePlaylist(){var t,l,h;if(!this.getId()||!this.$route.path.includes("/playlist/"))return;const e=(h=(l=(t=this.userData)==null?void 0:t.data)==null?void 0:l.playlists)==null?void 0:h[Number(this.getId())];document.title=`${this.playlistName} - reAudioPlayer One`,console.log(e.songs),this.playlist=e.songs,this.playlistName=e.name,this.playlistDescription=e.description},onPlaylistRearrange(e){const t=e.moved;!t||fetch("/api/rearrange",{method:"POST",body:JSON.stringify({playlistIndex:Number(this.getId()),songOldIndex:t.oldIndex,songNewIndex:t.newIndex})})},headerVisibilityChanged(e){this.fixedHeaderHidden=e},updateData(e){var t;if(e.path=="player.song"){let l=((t=e==null?void 0:e.data)==null?void 0:t.title)||"N/A";for(const h of this.playlist)h.playing=h.title==l}},loadPlaylist(){fetch("/api/loadPlaylist",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"playlist"})})},editPlaylist(){this.$refs.editPlaylistPopup.showModal=!0}},watch:{$route(){this.updatePlaylist()}}},E=e=>(C("data-v-673e34de"),e=e(),N(),e),ue={class:"playlist"},ce=x("Playlist"),he=E(()=>s("hr",null,null,-1)),pe={class:"padding-20"},_e={class:"grid"},me=E(()=>s("hr",null,null,-1)),ye={class:"playlistEntries"};function fe(e,t,l,h,o,i){const r=u("EditPlaylist"),d=u("fixed-playlist-header"),n=u("h7"),w=u("grid-header"),m=u("playlist-entry"),H=A("observe-visibility");return _(),y("div",ue,[a(r,{onClose:i.updatePlaylist,playlistName:o.playlistName,playlistDescription:o.playlistDescription,ref:"editPlaylistPopup",userData:l.userData},null,8,["onClose","playlistName","playlistDescription","userData"]),a(d,{onLoadPlaylist:i.loadPlaylist,ref:"fixedHeading",class:f({hidden:o.fixedHeaderHidden}),title:o.playlistName},null,8,["onLoadPlaylist","class","title"]),v((_(),y("div",{class:"padding-20 playlisteditor",onClick:t[0]||(t[0]=(...p)=>i.editPlaylist&&i.editPlaylist(...p))},[a(n,null,{default:c(()=>[ce]),_:1}),s("h1",null,b(o.playlistName),1),s("h5",null,b(o.playlistDescription),1)])),[[H,i.headerVisibilityChanged]]),he,s("div",pe,[s("span",{id:"loadPlaylist",onClick:t[1]||(t[1]=(...p)=>i.loadPlaylist&&i.loadPlaylist(...p)),class:"material-symbols-rounded"},"play_circle_filled"),s("span",{id:"addToPlaylist",onClick:t[2]||(t[2]=(...p)=>e.addToPlaylist&&e.addToPlaylist(...p)),class:"material-symbols-rounded"},"add_circle"),s("div",_e,[a(w),me,s("div",ye,[(_(!0),y(F,null,B(o.playlist,(p,V)=>(_(),T(m,{onDownload:i.download,key:V,onRequestUpdate:i.updatePlaylist,userData:l.userData,index:o.playlist.findIndex(U=>U.source==p.source),source:p.source,playing:p.playing,id:p.id,title:p.title,album:p.album,artist:p.artist,cover:p.cover,favourite:p.favourite,duration:p.duration},null,8,["onDownload","onRequestUpdate","userData","index","source","playing","id","title","album","artist","cover","favourite","duration"]))),128))])])])])}var ge=g(re,[["render",fe],["__scopeId","data-v-673e34de"]]);export{ge as default};
