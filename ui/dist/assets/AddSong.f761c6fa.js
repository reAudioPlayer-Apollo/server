import{_ as v,o as f,c as g,p as C,b as k,a as e,r as h,t as S,j as d,k as T,w as m,i as D,e as u,f as x,d as I,h as N,v as _,H as M,M as O,n as p}from"./index.dbf45948.js";import{F as V}from"./FindSources.1cb88bc4.js";const E={name:"GridHeader"},P=s=>(C("data-v-154a0bee"),s=s(),k(),s),U={class:"gridHeader"},F=P(()=>e("span",{class:"id"},"#",-1)),H=P(()=>e("span",{class:"title"},"Title",-1)),j=P(()=>e("span",{class:"album"},"Album",-1)),B=P(()=>e("span",{class:"clock material-symbols-rounded"},"schedule",-1)),q=[F,H,j,B];function J(s,t,n,y,i,o){return f(),g("div",U,q)}var L=v(E,[["render",J],["__scopeId","data-v-154a0bee"]]);const R={name:"FixedPlaylistHeader",components:{GridHeader:L},props:{title:String}},Y={class:"fixedPlaylistHeader"},G={class:"upperWrapper"};function z(s,t,n,y,i,o){const c=h("grid-header");return f(),g("div",Y,[e("div",G,[e("span",{id:"loadPlaylist",onClick:t[0]||(t[0]=a=>this.$emit("loadPlaylist")),class:"material-symbols-rounded hideIfMobile"},"play_circle"),e("h3",null,S(n.title),1)]),d(c,{class:"padding-20 darkback hideIfMobile"})])}var we=v(R,[["render",z],["__scopeId","data-v-f98f5a0c"]]);const X={name:"SongCtx",props:{liked:Boolean,isAutoPlaylist:Boolean},data(){return{playlists:[]}},methods:{hide(){this.$refs.contextmenu.hide()},show(s){const t=this.$refs.box.getBoundingClientRect(),n={top:t.height+t.top+window.scrollY,left:t.width+t.left+window.scrollX};this.$refs.contextmenu.show(n),s==null||s.stopPropagation()},like(){this.$emit("like")},remove(){this.$emit("remove")},addto(s){if(s==="new"){fetch("/api/playlist/create").then(t=>t.text()).then(t=>{this.$emit("addto",Number(t.replace("/playlist/","")))});return}this.$emit("addto",s)},download(){this.$emit("download")},update(){this.$emit("update")}}},W={ref:"box"},K=x("Remove from this playlist"),Q=x("Update Metadata");function Z(s,t,n,y,i,o){const c=h("v-contextmenu-item"),a=h("v-contextmenu-divider");h("v-contextmenu-submenu");const l=h("v-contextmenu"),r=T("contextmenu");return m((f(),g("div",W,[D(s.$slots,"default"),d(l,{ref:"contextmenu"},{default:u(()=>[d(c,{onClick:o.like},{default:u(()=>[x(S((n.liked?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1},8,["onClick"]),n.isAutoPlaylist?N("",!0):(f(),I(c,{key:0,onClick:o.remove},{default:u(()=>[K]),_:1},8,["onClick"])),N("",!0),d(a),d(c,{onClick:o.update},{default:u(()=>[Q]),_:1},8,["onClick"])]),_:1},512)])),[[r,void 0,"contextmenu"]])}var tt=v(X,[["render",Z]]);const et={name:"EditSong",components:{FindSources:V},props:{cover:String,album:String,artist:String,source:String,title:String,id:Number,userData:Object},data(){return{showModal:!1,dCover:this.cover,dAlbum:this.album,dArtist:this.artist,dTitle:this.title,dSource:this.source}},methods:{opencontextmenu(s){this.$refs.findSourcesEdit.show(s)},hideFindSourcesCtx(){this.$refs.findSourcesEdit.hide()},add(){this.showModal=!1,console.log(this.userData);for(const s of this.userData.data.playlists)for(const t of s.songs)t.id==this.id&&(console.log("found one"),t.source=this.dSource,t.title=this.dTitle,t.album=this.dAlbum,t.artist=this.dArtist,t.cover=this.dCover);fetch("/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.userData.data)}).then(s=>{console.log(s),this.$emit("close")})},loadMetadata(){},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}},watch:{id(){this.dCover=this.cover,this.dAlbum=this.album,this.dArtist=this.artist,this.dTitle=this.title,this.dSource=this.source}}},b=s=>(C("data-v-f97cb3b2"),s=s(),k(),s),st={class:"wrapper"},ot={class:"header"},it=b(()=>e("h3",null,"Edit song",-1)),nt=b(()=>e("span",{class:"material-symbols-rounded"}," close ",-1)),lt=[nt],at=b(()=>e("h4",null,"Source",-1)),dt={class:"content"},rt=b(()=>e("h4",null,"Title",-1)),ct={class:"content"},ut=b(()=>e("h4",null,"Album",-1)),ht={class:"content"},mt=b(()=>e("h4",null,"Artist",-1)),_t={class:"content"},pt=b(()=>e("h4",null,"Cover",-1)),ft={class:"content"},vt=["src"],yt={class:"confirm"};function gt(s,t,n,y,i,o){const c=h("FindSources"),a=h("vue-final-modal");return f(),g("div",null,[d(a,{onClick:o.hideFindSourcesCtx,modelValue:i.showModal,"onUpdate:modelValue":t[9]||(t[9]=l=>i.showModal=l),classes:"modal-container","content-class":"modal-content"},{default:u(()=>[e("div",st,[e("div",ot,[it,e("button",{class:"modal-close",onClick:t[0]||(t[0]=l=>i.showModal=!1)},lt)]),at,d(c,{ref:"findSourcesEdit",title:n.title,artist:n.artist},{default:u(()=>[e("div",dt,[m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>i.dSource=l),type:"text",ref:"source"},null,512),[[_,i.dSource]]),e("span",{class:"material-symbols-rounded more",ref:"sourceMore",onClick:t[2]||(t[2]=(...l)=>o.opencontextmenu&&o.opencontextmenu(...l))},"more_vert",512)])]),_:1},8,["title","artist"]),rt,e("div",ct,[m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>i.dTitle=l),type:"text"},null,512),[[_,i.dTitle]])]),ut,e("div",ht,[m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>i.dAlbum=l),type:"text",ref:"album"},null,512),[[_,i.dAlbum]])]),mt,e("div",_t,[m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>i.dArtist=l),type:"text"},null,512),[[_,i.dArtist]])]),pt,e("div",ft,[m(e("input",{type:"text",class:"addSong cover","onUpdate:modelValue":t[6]||(t[6]=l=>i.dCover=l),ref:"cover"},null,512),[[_,i.dCover]]),e("img",{onClick:t[7]||(t[7]=(...l)=>o.openInNewTab&&o.openInNewTab(...l)),class:"addSong cover",src:n.cover?n.cover:"/assets/img/music_placeholder.png"},null,8,vt)]),e("div",yt,[e("button",{onClick:t[8]||(t[8]=(...l)=>o.add&&o.add(...l)),class:"negative"},"Save")])])]),_:1},8,["onClick","modelValue"])])}var xt=v(et,[["render",gt],["__scopeId","data-v-f97cb3b2"]]);const bt=new M("reapOne.track",22),wt=new M("reapOne.playlist",22),St={name:"PlaylistEntry",components:{SongCtx:tt,Marquee:O,EditSong:xt},props:{index:Number,id:Number,source:String,artist:{type:String,default:"N/A"},cover:{type:String,default:"/assets/img/music_placeholder.png"},title:{type:String,default:"N/A"},album:{type:String,default:"N/A"},duration:{type:String,default:"N/A"},favourite:{type:Boolean,default:!1},playing:{type:Boolean,default:!1},userData:Object},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks"}},computed:{trackId(){return bt.encode(this.id)}},methods:{getPlaylistId(){return wt.decode(this.$route.params.id)},download(){this.$emit("download",this.index)},addToPlaylist(s){fetch("/api/add",{method:"POST",body:JSON.stringify({id:s,source:this.source})}).then(t=>{t.status==200&&this.$emit("requestUpdate")})},remove(){fetch("/api/remove",{method:"POST",body:JSON.stringify({playlistId:Number(this.getPlaylistId()),songId:this.id})}).then(s=>{s.status==200&&this.$emit("requestUpdate")})},update(){this.$refs.editSongPopup.showModal=!0},hideCtxMenu(){this.$refs.ctxMenu.hide()},showCtxMenu(s){console.log("show"),this.$refs.ctxMenu.show(s)},onselect(){this.highlighted=!this.highlighted,this.hideCtxMenu()},displayPlay(){const s=this.$refs.idOrPlay;s.innerHTML="play_arrow",s.classList.add("material-symbols-rounded")},displayId(){const s=this.$refs.idOrPlay;s.innerHTML=this.index+1,s.classList.remove("material-symbols-rounded")},playAt(){console.log(this.$route.path),this.index,this.$route.path.includes("/playlist/")&&Number(this.getPlaylistId()),this.$route.path.includes("/collection/tracks");const s=new CustomEvent("player.play",{detail:{id:this.id,favourite:this.favourited,album:this.album,artist:this.artist,title:this.title,duration:this.duration,cover:this.cover,source:this.source}});window.dispatchEvent(s)},setFavourite(){for(const s of this.userData.data.playlists)for(const t of s.songs)if(t.id==this.id){if(t.favourite==this.favourited||0)return;t.favourite=this.favourited?1:0}fetch("/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.userData.data)}).then(s=>{console.log(s),this.$emit("close")})}},watch:{favourited(){this.setFavourite()},favourite(){console.log("mounted",this.title,this.favourite,this.favourited),this.favourited=this.favourite,this.highlighted=!1}}},Ct={class:"track"},kt=["src"],Mt={class:"trackwrapper"},Pt={class:"duration"},At={class:"mobilePlaylist showIfMobile"},$t={class:"track"},Nt=["src"],Tt={class:"trackwrapper"};function Dt(s,t,n,y,i,o){const c=h("EditSong"),a=h("Marquee"),l=h("SongCtx");return f(),I(l,{onDownload:o.download,onAddto:o.addToPlaylist,onRemove:o.remove,onUpdate:o.update,onLike:t[9]||(t[9]=r=>i.favourited=!i.favourited),isAutoPlaylist:i.isAutoPlaylist,liked:i.favourited,ref:"ctxMenu"},{default:u(()=>[d(c,{userData:n.userData,onClose:s.updatePlaylist,ref:"editSongPopup",cover:n.cover,id:n.id,title:n.title,album:n.album,artist:n.artist,source:n.source},null,8,["userData","onClose","cover","id","title","album","artist","source"]),e("div",{onDblclick:t[3]||(t[3]=()=>{o.playAt(),o.onselect()}),onClick:t[4]||(t[4]=(...r)=>o.onselect&&o.onselect(...r)),onMouseover:t[5]||(t[5]=(...r)=>o.displayPlay&&o.displayPlay(...r)),onMouseleave:t[6]||(t[6]=(...r)=>o.displayId&&o.displayId(...r)),class:p(["playlistEntry hideIfMobile",{selected:i.highlighted}])},[e("span",{onClick:t[0]||(t[0]=(...r)=>o.playAt&&o.playAt(...r)),ref:"idOrPlay",class:p([{playing:n.playing},"id"])},S(n.index+1),3),e("div",Ct,[e("img",{src:n.cover||"/assets/img/music_placeholder.png"},null,8,kt),e("div",Mt,[e("span",{class:p(["title",{playing:n.playing}])},[d(a,{text:n.title},null,8,["text"])],2),e("span",{class:p(["artist",{playing:n.playing}])},[d(a,{text:n.artist},null,8,["text"])],2)])]),e("span",{class:p(["album",{playing:n.playing}])},[d(a,{text:n.album},null,8,["text"])],2),e("span",{onClick:t[1]||(t[1]=r=>i.favourited=!i.favourited),class:p(["favourite material-symbols-rounded",{showfavourite:i.favourited||i.highlighted,active:i.favourited}])},"favorite",2),e("span",Pt,S(n.duration),1),e("span",{onClick:t[2]||(t[2]=(...r)=>o.showCtxMenu&&o.showCtxMenu(...r)),class:p(["more material-symbols-rounded",{hidden:!i.highlighted}])},"more_horiz",2)],34),e("div",At,[e("div",$t,[e("img",{onClick:t[7]||(t[7]=(...r)=>o.playAt&&o.playAt(...r)),src:n.cover||"/assets/img/music_placeholder.png"},null,8,Nt),e("div",Tt,[e("span",{class:p(["title",{playing:n.playing}])},[d(a,{text:n.title},null,8,["text"])],2),e("span",{class:p(["artist",{playing:n.playing}])},[d(a,{text:n.artist},null,8,["text"])],2)])]),e("span",{onClick:t[8]||(t[8]=(...r)=>o.showCtxMenu&&o.showCtxMenu(...r)),class:"more material-symbols-rounded"},"more_horiz")])]),_:1},8,["onDownload","onAddto","onRemove","onUpdate","isAutoPlaylist","liked"])}var Se=v(St,[["render",Dt],["__scopeId","data-v-4b737ce4"]]);const $=new M("reapOne.playlist",22),It={name:"EditPlaylist",props:{playlistName:String,playlistDescription:String,userData:Object},data(){return{showModal:!1,cover:"",name:this.playlistName,description:this.playlistDescription}},methods:{apply(){this.showModal=!1,console.log("fetch"),this.userData.data.playlists[Number($.decode(this.$route.params.id))].name=this.name,this.userData.data.playlists[Number($.decode(this.$route.params.id))].description=this.description,fetch("/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.userData.data)}).then(s=>{console.log(s),this.$emit("close")})},remove(){this.userData.data.playlists.splice(Number($.decode(this.$route.params.id)),1),fetch("/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.userData.data)}).then(s=>{console.log(s),this.$emit("close")})}},watch:{playlistName(){this.name=this.playlistName},playlistDescription(){this.description=this.playlistDescription}}},A=s=>(C("data-v-da852f16"),s=s(),k(),s),Ot={class:"wrapper"},Vt={class:"header"},Et=A(()=>e("h3",null,"Edit details",-1)),Ut=A(()=>e("span",{class:"material-symbols-rounded"}," close ",-1)),Ft=[Ut],Ht=A(()=>e("h4",null,"Name",-1)),jt={class:"content"},Bt=A(()=>e("h4",null,"Description",-1)),qt={class:"content"},Jt={class:"confirm"};function Lt(s,t,n,y,i,o){const c=h("vue-final-modal");return f(),g("div",null,[d(c,{modelValue:i.showModal,"onUpdate:modelValue":t[5]||(t[5]=a=>i.showModal=a),classes:"modal-container","content-class":"modal-content"},{default:u(()=>[e("div",Ot,[e("div",Vt,[Et,e("button",{class:"modal-close",onClick:t[0]||(t[0]=a=>i.showModal=!1)},Ft)]),Ht,e("div",jt,[m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>i.name=a),type:"text",ref:"name"},null,512),[[_,i.name]])]),Bt,e("div",qt,[m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>i.description=a),type:"text",ref:"description"},null,512),[[_,i.description]])]),e("div",Jt,[e("button",{onClick:t[3]||(t[3]=(...a)=>o.remove&&o.remove(...a)),class:"negative left"},"Delete"),e("button",{onClick:t[4]||(t[4]=(...a)=>o.apply&&o.apply(...a)),class:"negative"},"Save")])])]),_:1},8,["modelValue"])])}var Ce=v(It,[["render",Lt],["__scopeId","data-v-da852f16"]]);const Rt={name:"FindSources",props:{artist:String,title:String},methods:{hide(){this.$refs.contextmenu.hide()},show(s){const t=this.$refs.box.getBoundingClientRect(),n={top:t.height+t.top+window.scrollY,left:t.width+t.left+window.scrollX};this.$refs.contextmenu.show(n),s==null||s.stopPropagation()},openSoundcloud(){window.open(`https://soundcloud.com/search?q=${this.artist} ${this.title}`)},openAudius(){window.open(`https://audius.co/search/${this.artist} ${this.title}`)},openYoutubeMusic(){window.open(`https://music.youtube.com/search?q=${this.artist} ${this.title}`)},openSpotify(){window.open(`https://open.spotify.com/search/${this.artist} ${this.title}`)}}},Yt={ref:"box"},Gt=x("Soundcloud"),zt=x("Audius"),Xt=x("Youtube Music"),Wt=x("Spotify");function Kt(s,t,n,y,i,o){const c=h("v-contextmenu-item"),a=h("v-contextmenu-submenu"),l=h("v-contextmenu"),r=T("contextmenu");return m((f(),g("div",Yt,[D(s.$slots,"default"),d(l,{ref:"contextmenu"},{default:u(()=>[d(a,{title:"Search on"},{default:u(()=>[d(c,{onClick:o.openSoundcloud},{default:u(()=>[Gt]),_:1},8,["onClick"]),d(c,{onClick:o.openAudius},{default:u(()=>[zt]),_:1},8,["onClick"]),d(c,{onClick:o.openYoutubeMusic},{default:u(()=>[Xt]),_:1},8,["onClick"]),d(c,{onClick:o.openSpotify},{default:u(()=>[Wt]),_:1},8,["onClick"])]),_:1})]),_:1},512)])),[[r,void 0,"contextmenu"]])}var Qt=v(Rt,[["render",Kt]]);const Zt=new M("reapOne.playlist",22),te={name:"AddSong",components:{FindSources:Qt},props:{userData:Object},data(){return{showModal:!1,cover:"",artist:"",title:""}},watch:{showModal(){!this.showModal||navigator.clipboard.readText().then(s=>{!this.isValidHttpUrl(s)||(this.$refs.source.value=s,this.loadMetadata())})}},methods:{isValidHttpUrl(s){let t;try{t=new URL(s)}catch{return!1}return t.protocol==="http:"||t.protocol==="https:"},opencontextmenu(s){this.$refs.findSources.show(s)},hideFindSourcesCtx(){this.$refs.findSources.hide()},getId(){return Number(Zt.decode(this.$route.params.id))},add(){this.showModal=!1,this.userData.data.playlists[this.getId()].songs.push({source:this.$refs.source.value,title:this.title,artist:this.artist,album:this.$refs.album.value,cover:this.cover,duration:"-1:59"}),fetch("/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.userData.data)}).then(s=>{console.log(s),this.$emit("close")})},loadMetadata(){},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}}},w=s=>(C("data-v-0a4313ad"),s=s(),k(),s),ee={class:"wrapper"},se={class:"header"},oe=w(()=>e("h3",null,"Add song",-1)),ie=w(()=>e("span",{class:"material-symbols-rounded"}," close ",-1)),ne=[ie],le=w(()=>e("h4",null,"Source",-1)),ae={class:"content"},de=w(()=>e("h4",null,"Title",-1)),re={class:"content"},ce=w(()=>e("h4",null,"Album",-1)),ue={class:"content"},he={type:"text",ref:"album"},me=w(()=>e("h4",null,"Artist",-1)),_e={class:"content"},pe=w(()=>e("h4",null,"Cover",-1)),fe={class:"content"},ve=["src"],ye={class:"confirm"};function ge(s,t,n,y,i,o){const c=h("FindSources"),a=h("vue-final-modal");return f(),g("div",null,[d(a,{onClick:o.hideFindSourcesCtx,modelValue:i.showModal,"onUpdate:modelValue":t[8]||(t[8]=l=>i.showModal=l),classes:"modal-container","content-class":"modal-content"},{default:u(()=>[e("div",ee,[e("div",se,[oe,e("button",{class:"modal-close",onClick:t[0]||(t[0]=l=>i.showModal=!1)},ne)]),le,d(c,{ref:"findSources",title:i.title,artist:i.artist},{default:u(()=>[e("div",ae,[e("input",{onChange:t[1]||(t[1]=(...l)=>o.loadMetadata&&o.loadMetadata(...l)),type:"text",ref:"source"},null,544),e("span",{class:"material-symbols-rounded more",ref:"sourceMore",onClick:t[2]||(t[2]=(...l)=>o.opencontextmenu&&o.opencontextmenu(...l))},"more_vert",512)])]),_:1},8,["title","artist"]),de,e("div",re,[m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>i.title=l),type:"text"},null,512),[[_,i.title]])]),ce,e("div",ue,[e("input",he,null,512)]),me,e("div",_e,[m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>i.artist=l),type:"text"},null,512),[[_,i.artist]])]),pe,e("div",fe,[m(e("input",{type:"text",class:"addSong cover","onUpdate:modelValue":t[5]||(t[5]=l=>i.cover=l),ref:"cover"},null,512),[[_,i.cover]]),e("img",{onClick:t[6]||(t[6]=(...l)=>o.openInNewTab&&o.openInNewTab(...l)),class:"addSong cover",src:i.cover?i.cover:"/assets/img/music_placeholder.png"},null,8,ve)]),e("div",ye,[e("button",{onClick:t[7]||(t[7]=(...l)=>o.add&&o.add(...l)),class:"negative"},"Add")])])]),_:1},8,["onClick","modelValue"])])}var ke=v(te,[["render",ge],["__scopeId","data-v-0a4313ad"]]);export{ke as A,Ce as E,we as F,L as G,Se as P};
